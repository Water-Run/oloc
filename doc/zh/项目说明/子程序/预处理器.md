# 预处理器  

预处理器是`oloc`在执行运算时的第一个子程序,负责将输入的表达式进行格式的统一化.  
预处理器实例于`Preprocessor`类.  

## 输入输出  

预处理器接受一个参数.  

- `expression`:`str` 输入的表达式  

预处理器的返回值为`str`,即处理后的表达式  

## 工作流  

预处理器按顺序依次执行如下内容.  

1. ***注释去除***  
   - **功能**  
      - 移除输入的表达式中的注释  
   - **实现**  
      - 检测`@`后的内容,移除结尾注释  
      - 检测`#`包裹的内容,移除自由注释  
   - **示例**  
      - *输入*: `1 + #note# 1 @注释`  
      - *输出*: `1 +  1`
   - **异常**  
      - `OlocCommentException`: 当`#`不匹配时  
2. ***符号映射***  
   - **功能**  
      - 根据[符号映射表](../数据/符号映射表.md)进行符号替换  
   - **实现**  
      - 使用`simpsave`从`olocconfig.ini`中读取符号映射表和并处理函数名称表至内存中  
      - 根据读取的字典,依次进行符号替换.保留函数名称表中保留的函数名,避免被干扰  
      > 由于字典有序性限制,`oloc`需要`python >= 3.7` 
   - **示例**  
      - *输入*: `_2 / 3**2 加 5^o × 4p =`  
      - *输出*: `2/3^2+5°×4π`
3. ***形式消除***  
    - **功能**  
      - 消除表达式中的一些特殊形式.包括数字分隔符,括号化简,正负号消除  
    - **实现**  
      - 正负号约除  
        - 检测表达式中存在的连续的`+`和`-`  
        - 按照正负号消除原则进行消除  
      - 数字分隔符消除  
        - 检查表达式终端`,`是否合法   
        - 移除表达式中的`,`  
    - **示例**  
      - *输入*: `3,00,00++--pow(1,100;1/2)`  
      - *输出*: `30000+pow(1100,1/2)`  
    - **异常**  
      - `OlocNumberSeparatorException`: 当数字分隔符位于非法位置时.如不位于数字的数字分隔符,或如位于数字开头或结尾的分隔符,或连续的`,`分隔符  
4. ***形式补全***  
    - **功能**  
      - 补全表达式中的一些特殊形式.如被省略的乘法符号  
    - **实现**  
      - 乘法符号补全  
        - 扫描表达式,检测到被省略乘号的位置  
        - 补全乘号  
5. ***分数化***  
   - **功能**  
      - 将表达式中的所有有理数转换为分数  
   - **实现**
      - *实现依赖词法分析器静态方法*  
      - 词法分析器扫描标注数字结构
      - 取出词法分析器扫描出的数字结构,并判断合法性  
      - 数字分数化
        - 带分数分数化  
            - 带分数解析为分数  
        - 有限小数分数化  
            - 有限小数解析为分数  
        - 无限循环小数分数化  
            - 无限循环小数解析并分数化  
        - 百分数分数化  
            - 百分小数解析为有限小数,在以下步骤统一进行分数化  
        - 分数化简  
            - 词法分析器扫描标注分数结构  
            - 执行字符串分数化简  
   - **示例**  
      - *输入*: `pow(1,0000;1/2)+100%+50\1/2+0.5+2.222...`  
      - *输出*: `pow(10000,1/2)+1+101/2+1/2+20/9`  
6. ***函数转换***  

---
***[点此](../项目说明梗概.md)跳转回说明梗概页面***  
