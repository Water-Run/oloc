# oloc: 项目说明梗概  

本部分文档简述了`oloc`的实现及相关内容.  

## 项目结构

在使用`oloc`时,用户需要使用的唯一函数是`calculate()`.  
`calculate()`的返回值是`OlocResult`类的实例.不过,由于其实现了魔术方法,可以视作字符串使用,并支持`float`和`int`的转换.  
> 关于`OlocResult()`的更多内容,见[求值器](子程序/求值器.md)  

源码路径下包括如下文件:  

| 名称                | 说明                              |  
|-------------------|---------------------------------|  
| `__init__.py`     | `oloc`的初始化                      |  
| `core.py`         | -                               |  
| `evaluator.py`    | -                               |  
| `exceptions.py`   | -                               |  
| `parser.py`       | -                               |  
| `preprocessor.py` | 表达式预处理                          |  
| `result.py`       | 结果相关,包括结果类`OlocResult`和格式化过滤输出器 |  
| `utils.py`        | 辅助工具                            |  

另外,在`data`路径下,包括`olocdata.ini`(`simpsave`数据文件)和`_data_loader.py`脚本.见下文数据表部分内容.  

### 子程序表  

将表达式传递给`calculate()`后,实质上是依次调用下表中的子程序实现计算链:  

| 顺序 | 名称                            | 说明                                                  | 状态  |
|----|-------------------------------|-----------------------------------------------------|-----|
| 1  | [预处理器](./子程序/预处理器.md)         | 对输入的表达式进行预处理，统一输入以便后续处理，包括符号映射、函数转换、数字规范化、注释去除等     | 未完成 |  
| 2  | [词法分析器](./子程序/词法分析器.md)       | 将预处理后的表达式分解为最小的语法单元（如数字、运算符、括号、函数等），形成标记（Token）列表   | 未完成 |  
| 3  | [语法分析器](./子程序/语法分析器.md)       | 基于词法单元构建语法树，检测表达式的语法正确性，确保符合数学表达式的结构规则              | 未完成 |  
| 4  | [语义分析器](./子程序/语义分析器.md)       | 检查表达式的语义正确性（如分母是否为零，无理数是否声明转化值），确保数学逻辑合法            | 未完成 |  
| 5  | [求值器](./子程序/求值器.md)           | 根据语法树对表达式进行求值，支持逐步计算结果的生成，并返回最终结果                   | 未完成 |  
| 6  | [格式化输出过滤器](./子程序/格式化输出过滤器.md) | 对计算结果进行格式化和标准化，以确保输出统一、美观                           | 未完成 |  
| -  | [异常处理器](./子程序/异常处理器.md)       | 定义和处理各阶段可能出现的异常（预处理异常、语法异常、语义异常、计算异常等），并提供清晰的错误信息提示 | 未完成 |

有关项目中使用的通用工具,见[通用工具](./子程序/通用工具.md).

#### 关于计算限时  

由于`Windows`平台和`python`有关多线程部分的限制,**计算限时的实现和`calculate`函数一同实现在`core.py`下**.  
计算的实际执行函数是`_execute_calculation()`,作为子进程使用队列与`calculate`进行通信.主进程通过`process.join()`中的`timeout`参数控制时长,当计算超时时,通过`process.terminate()`中断并抛出`OlocTimeOutException`.  
> 由于`calculate()`使用了关键字参数`*`,**`time_limit`必须显示的调用进行修改**.其缺省值为`1.0`,即在计算超过1秒后中断  
> > 具体表达式的计算时长与不同的设备,环境和当前运行状态有关    
> > **当`time_limit` < 0时,计算限时不生效**  

### 数据表  

以下表格存储了在预处理过程中的所需数据:  

| 名称                           | 说明 | 状态  |
|------------------------------|----|-----|
| [符号映射表](./数据/符号映射表.md)       | -  | 未完成 |  
| [函数转换表](./数据/函数转换表.md)       | -  | 未完成 |

**其实际上存储在`data`目录下的`olocdata.ini`文件中.使用`simpsave`进行存储操作**.  
修改相同目录下的`_data_loader.py`中对应的字典并运行该脚本可实现表格内容自定义.  

---  
*阅读项目说明文档,点击[这里](../README.md)*  
